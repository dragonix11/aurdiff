# Maintainer: Spider.007 <archPackage@spider007.net>
# Contributor: Spider.007 <archPackage@spider007.net>
pkgname=libevent-hphp
pkgver=1.4.14b
pkgrel=4
pkgdesc="Patched libevent for HipHop"
arch=('any')
url="http://wiki.github.com/facebook/hiphop-php/"
license=('custom')
depends=()
source=("https://github.com/libevent/libevent/archive/release-1.4.14b-stable.zip" "https://github.com/facebook/hiphop-php/raw/363d1bb20fe84b4cdc2dc0f4c7b1dd39d167a1f5/hphp/third_party/libevent-1.4.14.fb-changes.diff")
md5sums=('e855c2e2c0c6fa5c97bc1a7fed3b8260'
         'c4f890bc52772f15b72983058fd92ff2')

build() {
  cd $srcdir/libevent-release-$pkgver-stable/

  CMAKE_PREFIX_PATH=/opt/hiphop

  patch < $srcdir/libevent-1.4.14.fb-changes.diff
  sed -i 's/test\/Makefile//g' configure.in
  ./autogen.sh
  ./configure --prefix=$CMAKE_PREFIX_PATH

  make || return 1
  make DESTDIR="$pkgdir" install || return 1
}
