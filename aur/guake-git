# Maintainer: Miguel Useche <migueluseche@skatox.com>
# Contributor: Anton Leontiev <unsector /at/ km.ru>
pkgname=guake-git
pkgver=20130922
pkgrel=1
pkgdesc="Top-down terminal for Gnome"
arch=('i686' 'x86_64')
url="http://guake.org/"
license=('GPL')
depends=('python2' 'pygtk' 'gnome-python' 'vte' 'python2-notify' 'python2-dbus' 'python2-xdg' 'pkgconfig' 'gtk2' 'glib2')
makedepends=('git' 'intltool' 'gnome-common')
provides=('guake')
conflicts=('guake')
source=('guake-git.patch')
sha512sums=('b39c700bbbd4b4455a56b3afa235f52a933dec34ef0e2004d8b469ffb2777c9d62ef163a3b70e41bfaf5a7f7d10d48f5102f5d968b95d920f065f0473e41fca4')
install=guake.install

_gitroot="git://gitorious.org/guake/guake.git"
_gitname="guake"

build() {
  cd $srcdir/
  msg "Connecting to GIT server...."
  if [ -d $srcdir/$_gitname ] ; then
    cd $_gitname && git pull origin
    msg "The local files are updated."
  else
    git clone $_gitroot
  fi
  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  cp -r $srcdir/$_gitname $srcdir/$_gitname-build
  cd $srcdir/$_gitname-build
  patch -Np1 -i $srcdir/$pkgname.patch
  PYTHON="`which python2`" ./autogen.sh --prefix=/usr --sysconfdir=/usr/share --disable-static 
  make
}

package(){
  cd $srcdir/$_gitname-build
  make DESTDIR=$pkgdir install
}
