# Maintainer: Anish Bhatt anish [at] gatech [dot] edu

pkgname='pipelight'
pkgver=1
pkgrel=1
pkgdesc="A browser plugin which allows one to use windows only plugins inside Linux browser"
url="https://launchpad.net/netflix-desktop/"
arch=('x86_64')
license=('LGPL')

depends=('wine-silverlight' 'ttf-ms-fonts' 'wget')
makedepends=('mingw-w64-gcc')

source=("https://bitbucket.org/mmueller2012/pipelight/get/master.tar.gz")
md5sums=(SKIP)

_prefix=/usr

#change this if your wine-silverlight is installed elsewhere
_wineprefix=/usr

build() {
  pushd `tar tf master.tar.gz | head -n 1`
  sed -i '2 a\ CXXFLAGS        := -static-libgcc -static-libstdc++ $(CXXFLAGS)' src/windows/Makefile
  ./configure --prefix=$_prefix
  make
  pushd share
  sed -i "s|/opt/wine-compholio|$_wineprefix|g" pipelight 
  sed -i "s|PLUGIN_LOADER_PATH|$_prefix/share/pipelight/pluginloader.exe|g" pipelight

  # this needs to change if you're using a custom prefix for wine-silverlight
  sed -i "s|.wine-pipelight|.wine|g" pipelight
  popd
  popd
}

package() {
  cd `tar tf master.tar.gz | head -n 1`
  make PREFIX=$_prefix DESTDIR="$pkgdir" install
}

# vim:set ts=2 sw=2 et:
