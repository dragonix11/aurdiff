# Contributor: core <angrycore@gmail.com>
# Maintainer Evgeniy "arcanis" Alekseev <esalexeev@gmail.com>

pkgname=qmmp-qsmmp-git
_pkgname=qmmp-qsmmp
pkgver=20130914
pkgrel=2
pkgdesc="Amarok-like interface for qmmp. Git version."
arch=('i686' 'x86_64')
url="http://gitorious.org/qsmmp"
license=('GPL2')
depends=('qmmp' 'libqxt')
makedepends=('git')
install=${_pkgname}.install
source=(${_pkgname}.desktop)
md5sums=('c22490f772c753f2ed6e611317b8d8d4')

_gitroot="git://gitorious.org/qsmmp/qsmmp.git"
_gitname="qsmmp"

build()
{
  cd ${srcdir}
  msg "Connecting to GIT server..."
  if [[ -d ${_gitname} ]]; then
    cd ${_gitname} && git pull origin
    msg "The local files are updated"
  else
    git clone ${_gitroot} ${_gitname}
  fi
  msg "GIT checkout done or server timeout"
  msg "Starting build..."
  
  rm -rf ${srcdir}/${_gitname}-build
  cp -r ${srcdir}/${_gitname} ${srcdir}/${_gitname}-build
  cd ${srcdir}/${_gitname}-build
  msg "Checkout to qmmp-9999"
  git checkout origin/qmmp-9999
  msg "Fix bug with building"
  git reset --hard 3a477c0
  
  qmake-qt4 PREFIX=/usr -Wnone
  make || return 1
}

package()
{
  cd ${srcdir}/${_gitname}-build
  make INSTALL_ROOT=${pkgdir} install || return 1
  install -D -m644 ${srcdir}/${_pkgname}.desktop $pkgdir/usr/share/applications/${_pkgname}.desktop || return 1
}
