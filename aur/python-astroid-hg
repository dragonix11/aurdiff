# Maintainer: Jonathan Kotta <jpkotta at gmail dot com>

pkgbase=python-astroid-hg
pkgname=$pkgbase
true && pkgname=('python-astroid-hg' 'python2-astroid-hg')
pkgver=20130916
pkgrel=1
pkgdesc="Provides an AST representation for Python code."
arch=('any')
url="http://www.pylint.org/astroid"
license=('LGPL')
makedepends=('python2' 'python' 'mercurial')
source=()
sha1sums=()

build() {

  cd "${srcdir}"
  if [ -d astroid ] ; then
    (cd astroid ; hg pull -u || return 1)
  else
    hg clone "https://bitbucket.org/logilab/astroid" astroid || return 1
  fi
  
  cp -a astroid astroid-py3

  (cd astroid; python2 setup.py build)

  (cd astroid-py3 ; python3 setup.py build)
}

package_python2-astroid-hg() {
  depends=('python2' 'python2-logilab-common')
  replaces=('python2-logilab-astng')
  provides=('python2-astroid')
  conflicts=('python2-logilab-astng' 'python2-astroid')
  cd "${srcdir}"/astroid

  python2 setup.py install --optimize=1 --skip-build --prefix=/usr --root="${pkgdir}"

  # fix permissions ...
  find "${pkgdir}" -type f -exec chmod +r {} \;
}

package_python-astroid-hg() {
  depends=('python' 'python-logilab-common')
  replaces=('python-logilab-astng')
  provides=('python-astroid')
  conflicts=('python-logilab-astng' 'python-astroid')
  cd "${srcdir}"/astroid-py3

  python3 setup.py install --optimize=1 --skip-build --prefix=/usr --root="${pkgdir}"

  # fix permissions ...
  find "${pkgdir}" -type f -exec chmod +r {} \;
}
