# Maintainer: perlawk
pkgname=gnu-scm  
_pkgname=scm  
pkgver=5f1
pkgrel=1
pkgdesc="A Scheme implementation conforming to Revised5 Report on the Algorithmic Language Scheme and the IEEE P1178 specification*. Scm is written in C and runs under plenty different systems."
url="http://people.csail.mit.edu/jaffer/SCM"
arch=('i686' 'x86_64')
license=('LGPL')
depends=(slib)
source=("http://groups.csail.mit.edu/mac/ftpdir/scm/${_pkgname}-$pkgver.zip")

build() {
  export SCHEME_LIBRARY_PATH=/usr/share/slib/
  cd "$srcdir/$_pkgname"

  make clean
  ./configure --prefix="$pkgdir/usr/"
 sed -i 's/<strings.h>/<string.h>/g;' findexec.c
 sed -i 's/<strings.h>/<string.h>/g;' rgx.c 
 sed -i 's/<strings.h>/<string.h>/g;' socket.c
  
  make scmlit

  ./build > buildscm
  chmod +x buildscm
  ./buildscm
}

package() {
  export SCHEME_LIBRARY_PATH=/usr/share/slib/
  cd "$srcdir/$_pkgname"

  install -d "$pkgdir/usr/bin/"
  touch "$pkgdir/usr/bin/scm"
  echo "#!/bin/sh" >> "$pkgdir/usr/bin/scm"
  echo "export SCHEME_LIBRARY_PATH=/usr/share/slib/" >> "$pkgdir/usr/bin/scm"
  echo "export SCM_INIT_PATH=/usr/share/scm/require.scm"  >> "$pkgdir/usr/bin/scm"
  echo "/usr/share/scm/scm $*" >> "$pkgdir/usr/bin/scm"
  chmod +x "$pkgdir/usr/bin/scm"

  install -D -m755 scm "$pkgdir/usr/share/scm/scm"

	for file in *.scm; do
		install -D -m644 $file "$pkgdir/usr/share/scm/$file"
	done

}
md5sums=('98be8275f5c69d234c55a8a995a500dd')
