# Maintainer: kfgz <kfgz at interia pl>
# Contributor: hauzer <alokinpwn at gmail dot com>

pkgname=pburn
pkgver=4.0.5
pkgrel=1
pkgdesc="CD/DVD recording program used in Puppy Linux."
arch=('any')
url="http://murga-linux.com/puppy/viewtopic.php?t=23881"
license=('GPL')
depends=('cddetect' 'dvd+rw-tools' 'gtkdialog' 'hotplug2stdout' 'usleep')
makedepends=('pet2tgz')
optdepends=('dvdauthor: for burning video-DVD'
            'ffmpeg: for converting audio/video'
            'normalize: for volume settings on Audio-CD'
            'pfilesearch: for file search'
            'vamps: for shrinking video-DVD'
            'vcdimager: for burning Video-CD'
            'vobcopy: for copying video-DVD'
            'nrg2iso: for converting CD or DVD image generated by Nero Burning Rom to ISO format')

#source=('pburn-3.6.0.pet')
#md5sums=('86c51638cbc4784b72812bc30c2fccfe')

#build() {
#  cd "${startdir}"
#  ln -sf "${startdir}"/${pkgname}-${pkgver}.pet "${srcdir}"/${pkgname}-${pkgver}.pet
#  pet2tgz -i "${srcdir}"/${pkgname}-${pkgver}.pet -o "${srcdir}"/${pkgname}-${pkgver}.tar.gz
#  cd "${srcdir}"
#  tar -xzf "${srcdir}"/${pkgname}-${pkgver}.tar.gz
#}

_md5sum=991c1884cdb9fe07005b59670fde7b05

build() {
  cd "${startdir}"
  if [ -e ${pkgname}-${pkgver}.pet ]; then
    if [ ${_md5sum} != `md5sum ${pkgname}-${pkgver}.pet | awk '{print $1}'` ]; then error "Md5sum is incorrect!" && exit; fi
    ln -sf "${startdir}"/${pkgname}-${pkgver}.pet "${srcdir}"/${pkgname}-${pkgver}.pet
    pet2tgz -i "${srcdir}"/${pkgname}-${pkgver}.pet -o "${srcdir}"/${pkgname}-${pkgver}.tar.gz
    cd "${srcdir}"
    tar -xzf "${srcdir}"/${pkgname}-${pkgver}.tar.gz
  else
    #wget --user=puppy --password=linux http://www.meownplanet.net/zigbert/${pkgname}-${pkgver}.pet
    wget http://www.meownplanet.net/zigbert/${pkgname}-${pkgver}.pet
    #wget http://kfgz.mydevil.net/${pkgname}-${pkgver}.pet
    if [ ${_md5sum} != `md5sum ${pkgname}-${pkgver}.pet | awk '{print $1}'` ]; then error "Md5sum is incorrect!" && exit; fi
    ln -sf "${startdir}"/${pkgname}-${pkgver}.pet "${srcdir}"/${pkgname}-${pkgver}.pet
    pet2tgz -i "${srcdir}"/${pkgname}-${pkgver}.pet -o "${srcdir}"/${pkgname}-${pkgver}.tar.gz
    cd "${srcdir}"
    tar -xzf "${srcdir}"/${pkgname}-${pkgver}.tar.gz
  fi
}


package() {
	
#  cat > ${pkgname} <<EOF
##!/bin/bash
#if [[ ! -f $HOME/.pfilesearch/pfilesearchrc ]] ; then
#  if [[ ! -d $HOME/.pfilesearch ]] ; then
#    mkdir $HOME/.pfilesearch
#  fi
#  touch $HOME/.pfilesearch/pfilesearchrc
#fi
#
#"/usr/share/${pkgname}/${pkgname}" "\$@"
#EOF

  cat > ${pkgname} <<EOF
#!/bin/bash
"/usr/share/${pkgname}/${pkgname}" "\$@"
EOF

  cat > ${pkgname}.desktop <<EOF
[Desktop Entry]
Encoding=UTF-8
Name=Pburn CD/DVD/Blu-ray writer
Name[de]=Pburn CD/DVD/Blu-ray Brenner
Name[es]=Pburn-Grabador de CD/DVD/Blu-ray
Name[fr]=Graveur CD/DVD/Blu-ray
Name[hu_HU]=Pburn CD/DVD/Blu-ray író
Name[ja]=Pburn CD/DVD/Blu-ray書き込み
Icon=/usr/share/${pkgname}/pburn20.png
Comment=Pburn CD/DVD/Blu-ray writer
Exec=${pkgname}
Terminal=false
Type=Application
Categories=Multimedia;Utility;
GenericName=Pburn CD/DVD/Blu-ray writer
EOF

  install -D -m755 ${pkgname} "${pkgdir}"/usr/bin/${pkgname}
  install -D -m644 ${pkgname}.desktop "${pkgdir}"/usr/share/applications/${pkgname}.desktop

  mkdir -p "${pkgdir}"/usr/share
  mkdir -p "${pkgdir}"/usr/share/locale/en/LC_MESSAGES
  cp -r "${srcdir}"/${pkgname}-${pkgver}/usr/local/${pkgname} "${pkgdir}"/usr/share/
  cp -r "${srcdir}"/${pkgname}-${pkgver}/usr/share/doc "${pkgdir}"/usr/share/
}
