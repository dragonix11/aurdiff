# Maintainer: q9 <qqqqqqqqq9 at web dot de>
pkgname=scidb-svn
_realpkgname=trunk
pkgver=20130917
pkgrel=2
# epoch=
pkgdesc="Scidb is a Chess Information Data Base SVN-Checkout"
arch=('x86_64' 'i686')
url="http://scidb.sourceforge.net/"
license=('GPL2')
# groups=()
depends=('tk' 'zziplib' 'shared-mime-info'  'minizip' 'libxcursor' 'libsm' 'hicolor-icon-theme' 'gdbm')
# makedepends=()
# checkdepends=()
# optdepends=()
# provides=()
conflicts=('scidb')
# replaces=()
# backup=()
options=('!buildflags' '!makeflags')
install=$pkgname.install
# changelog=
source=(svn://svn.code.sf.net/p/scidb/code/trunk
        $pkgname.desktop
        $pkgname.install
        configure.patch
        best_move.cpp.patch
        cbh2si4.cpp.patch
        cdb2sci.cpp.patch 
        mime.patch)
# noextract=()
md5sums=('SKIP'
         '16ebfb8498c2806cfbb7e53e8c631a71'
         '11cb4ae33ff9c324c0aa0008238c8f93'
         '0cc02fc958305e0a0cb76291fee25674'
         '9b3c407b8f4c583224785312398f38bd'
         'e154c085ac785887b88fab1bb2fab1da'
         'a8ee46c3df677b742009ae07d02e4eda'
         '6a07a75a30e3dc19b7ad44a8fbc9b092')

prepare() {
   cp -r $srcdir/$_realpkgname  $srcdir/$_realpkgname-build
    patch -p0 -i "${srcdir}/mime.patch"
    patch -p0 -i "${srcdir}/configure.patch"
    patch -p0 -i "${srcdir}/best_move.cpp.patch"
    patch -p0 -i "${srcdir}/cbh2si4.cpp.patch"
    patch -p0 -i "${srcdir}/cdb2sci.cpp.patch"
}

build() {
	cd "$srcdir/$_realpkgname-build"
	./configure --prefix="$pkgdir/usr" --exec-prefix="$pkgdir/usr" --enginesdir="$pkgdir/usr/bin" --datadir="$pkgdir/usr/share/" --mandir="$pkgdir/usr/share/man"
	make
}

package() {
	cd "$srcdir/$_realpkgname-build"
	mkdir -p "$pkgdir/usr/share/icons/hicolor" "$pkgdir/usr/share/mime/packages/" "$pkgdir/usr/share/applications" "$pkgdir/usr/share/desktop-directories"
  XDG_DATA_DIRS="$pkgdir/usr/share" make install
  sed -i -e "s@/usr/local/engines@/usr/share/scidb-beta/engines@g;s@$pkgdir@@g" $pkgdir/usr/bin/scidb-beta
  sed -i -e "s@$pkgdir@@g" $pkgdir/usr/bin/update-scidb-photo-files
}
