# Maintainer: jdarch <jda.cloud plus archlinux at gmail.com>

pkgname=zotonic
pkgver=0.9.4
pkgrel=1
pkgdesc="Content management system (web-CMS) server written in Erlang"
arch=('any')
url="http://zotonic.com/"
license=("Apache")
depends=('erlang-nox'
         'postgresql'
         'imagemagick')
optdepends=('perl-image-exiftool: Enable image autorotation'
            'nginx: Proxy Zotonic with nginx'
            'varnish: Speed up Zotonic with Varnish')
backup=('etc/zotonic/config'
        'etc/zotonic/erlang.config')
install=${pkgname}.install
source=("http://zotonic.googlecode.com/files/${pkgname}-${pkgver}.zip"
	"${pkgname}.service"
        "config"
        "erlang.config")
md5sums=('ea08f76604a0cb7bf80194fa809c1589'
         '61d44c29d8b0e10541109c062bf6cfc2'
         'f95774d74cb9ec7dd780615f7be57325'
         '4f09c0c994f5a17844b8ed999d3e7e39')
sha512sums=('b5e09f585c26e07797a8b21f7ea1baf201da05a90a016d3522e649244969cb33a2814b494a746179cd1423284e2689fda50ff1e01a3fe0108b8d127ce90c67a3'
            '116b349c4a60e58f11444fdaebc748e022df26b5b7be9f11f39c39831d3726527007484d8076450de74a560daeafc83f36081c42a8aae9ea4e28ceb653585a8b'
            '7e7db02d2b27429ee63e79004ee97a9e10faefb823529c73647776b0ef5c6331e0fe2c60a6780e5beb099fa1724ad9dea92d8840cc10bbc78b26630129abc993'
            'a6e5069e087a314053dab3774ecb123b5d5888c561430ecf02be34b72b3917c513d076323667188fde0ee6c2014e44f41b3a0a4b8fd79dd17c5523425f6979d8')

#build() {
#   cd "${srcdir}/${pkgname}"
#   make
#}

package() {
   mkdir -p "${pkgdir}/etc/${pkgname}"
   mkdir -p "${pkgdir}/usr/lib/systemd/system"
   mkdir -p "${pkgdir}/var/lib/"
   mkdir -p "${pkgdir}/var/log/${pkgname}"

   cp -r -t "${pkgdir}/var/lib/" "${srcdir}/${pkgname}"
   install -m 660 "${srcdir}/config" "${pkgdir}/etc/${pkgname}"
   install -m 660 "${srcdir}/erlang.config" "${pkgdir}/etc/${pkgname}"
   install -m 644 "${srcdir}/${pkgname}.service" "${pkgdir}/usr/lib/systemd/system"

   ln -s "/etc/${pkgname}/config" "${pkgdir}/var/lib/${pkgname}/priv/config"
   ln -s "/etc/${pkgname}/erlang.config" "${pkgdir}/var/lib/${pkgname}/priv/erlang.config"
}
