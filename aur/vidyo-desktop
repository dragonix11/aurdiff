# Maintainer: Gero MÃ¼ller <gero.mueller@physik.rwth-aachen.de>
# see https://bugzilla.mozilla.org/show_bug.cgi?id=701083

pkgname=vidyo-desktop
pkgver=2.3.0.035
pkgrel=2
arch=('x86_64')
depends=('alsa-lib' 'qt4' 'libidn')
pkgdesc="Desktop client for vidyo conferencing system used at CERN. Including fix."
makedepends=('rpmextract')
license=('proprietary')
url="https://vidyoportal.cern.ch"

source=(http://information-technology.web.cern.ch/sites/information-technology.web.cern.ch/files/VidyoDesktopInstaller-sl564-TAG_VD_${pkgver//./_}.rpm
        totally_ubuntu.c
        ubuntu-lsb-release
        VidyoDesktop)

build() {
  cd "${srcdir}"
  
  mkdir -p ext
  (cd ext && rpmextract.sh "${srcdir}"/VidyoDesktopInstaller-sl564-TAG_VD_${pkgver//./_}.rpm)
  gcc -fPIC -shared -Wl,-soname,totally-ubuntu.so -o totally_ubuntu.so totally_ubuntu.c
}

package() {
  msg2 "Moving files to package"
  cp -av "${srcdir}/ext"/* "${pkgdir}"
  cp -v "${srcdir}/"{totally_ubuntu.so,ubuntu-lsb-release} "${pkgdir}/opt/vidyo/VidyoDesktop"
  cp -v "${srcdir}/VidyoDesktop" "${pkgdir}/usr/bin/"
}

md5sums=('50be2bc88f402d64f1c1b24e86a3a714'
         '34233f193104e834096f68aab1a1867a'
         'a5b55e4f6ceb3c67a338699916cceacf'
         'a1cefc2bc531929d5c6aadc785abd615')
