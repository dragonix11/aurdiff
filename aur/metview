# Contributor: Graziano Giuliani <graziano.giuliani@poste.it>
pkgname=metview
pkgver=4.3.10
pkgrel=1
pkgdesc="ECMWF interactive meteorological application"
arch=(i686 x86_64)
url="https://software.ecmwf.int/wiki/display/METV/Home"
license=('APACHE')
groups=(science)
depends=(magics++ mksh openmotif qt4)
makedepends=()
provides=()
conflicts=()
replaces=()
backup=()
options=()
install=
source=(https://software.ecmwf.int/wiki/download/attachments/3964985/Metview-${pkgver}.tar.gz imagemagick_xpm_fix.patch)
noextract=()
md5sums=('43068c2b6e60a6b32d12ff3e165c649a'
         '4ab00461ee0fe6d76081eaa89ffe9963')

build() {
  cd Metview-${pkgver}
  chmod 644 share/metview/icons/fix_last_line
  patch -p0 -i $srcdir/imagemagick_xpm_fix.patch
  chmod 755 share/metview/icons/fix_last_line
  FC=gfortran F77=gfortran F9X=gfortran PYTHON=python2 \
  QMAKE=/usr/bin/qmake-qt4 MOC=/usr/bin/moc-qt4 \
  UIC=/usr/bin/uic-qt4 RCC=/usr/bin/rcc-qt4 \
  ./configure --with-python-command=/usr/bin/python2 --with-proj4=/usr \
  --with-grib-api=/usr --with-emos-libraries=/usr --with-netcdf=/usr \
  --with-magics-home=/usr --with-qt=/usr --prefix=/usr \
  CPPFLAGS="-I/usr/include/qt5/QtWidgets"
  make || return 1
}

package()
{
  cd Metview-${pkgver}
  make DESTDIR="$pkgdir" install
}

# vim:set ts=2 sw=2 et:
